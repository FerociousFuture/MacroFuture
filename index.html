<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Pruebas M√©dicas</title>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        textarea { height: 80px; resize: vertical; }
        
        .btn-container { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        
        /* Botones con colores actualizados */
        .btn-add { background-color: #8E44AD; color: white; } /* Morado bot√≥n */
        .btn-add:hover { background-color: #732d91; }
        .btn-download { background-color: #2c3e50; color: white; }
        .btn-download:hover { background-color: #1a252f; }

        /* Estilo de la tabla de previsualizaci√≥n */
        .preview-area { margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        
        /* CAMBIO DE COLORES EN CSS (VISTA WEB) */
        th { 
            background-color: #6A1B9A; /* Morado Oscuro */
            color: white; 
            padding: 12px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            border: 1px solid #ccc;
        }
        td { 
            border: 1px solid #ccc; 
            padding: 10px; 
            vertical-align: middle; 
            background-color: #F3E5F5; /* Lavanda muy suave */
        }
        
        .img-preview { width: 100px; height: auto; display: block; margin: 0 auto; border-radius: 4px; }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

<div class="container">
    <h1>Registro de Pruebas Fisioterap√©uticas</h1>
    
    <div class="form-group">
        <label>Nombre de la Prueba:</label>
        <input type="text" id="nombre" placeholder="Ej: Signo de Bonnet">
    </div>

    <div class="form-group">
        <label>Imagen (Foto):</label>
        <input type="file" id="imagenInput" accept="image/*">
    </div>

    <div class="form-group">
        <label>Valoraci√≥n de la Prueba (Qu√© eval√∫a):</label>
        <textarea id="valoracion" placeholder="Describe qu√© eval√∫a la prueba..."></textarea>
    </div>

    <div class="form-group">
        <label>Prueba a Compa√±eros:</label>
        <select id="resultado">
            <option value="NEGATIVA">NEGATIVA</option>
            <option value="POSITIVA">POSITIVA</option>
        </select>
    </div>

    <div class="btn-container">
        <button class="btn-add" onclick="agregarFila()">‚ûï Agregar a la Lista</button>
        <button class="btn-download" onclick="descargarExcel()">üì• Descargar Excel Final</button>
    </div>

    <div class="preview-area">
        <h3>Previsualizaci√≥n:</h3>
        <table id="tablaPreview">
            <thead>
                <tr>
                    <th>Nombre de la Prueba</th>
                    <th>Imagen</th>
                    <th>Valoraci√≥n de la Prueba</th>
                    <th>Prueba a Compa√±eros</th>
                </tr>
            </thead>
            <tbody id="cuerpoTabla">
                </tbody>
        </table>
    </div>
</div>

<script>
    let datosParaExcel = [];

    function leerImagen(input) {
        return new Promise((resolve, reject) => {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    resolve(e.target.result); 
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                resolve(null);
            }
        });
    }

    async function agregarFila() {
        const nombre = document.getElementById('nombre').value;
        const valoracion = document.getElementById('valoracion').value;
        const resultado = document.getElementById('resultado').value;
        const inputImg = document.getElementById('imagenInput');

        if (!nombre || !valoracion) {
            alert("Por favor completa el nombre y la valoraci√≥n.");
            return;
        }

        const imagenBase64 = await leerImagen(inputImg);

        datosParaExcel.push({
            nombre: nombre,
            valoracion: valoracion,
            resultado: resultado,
            imagen: imagenBase64
        });

        const tbody = document.getElementById('cuerpoTabla');
        const nuevaFila = tbody.insertRow();
        
        nuevaFila.innerHTML = `
            <td>${nombre}</td>
            <td style="text-align:center;">${imagenBase64 ? `<img src="${imagenBase64}" class="img-preview">` : 'Sin imagen'}</td>
            <td>${valoracion}</td>
            <td style="text-align:center; font-weight:bold;">${resultado}</td>
        `;

        document.getElementById('nombre').value = '';
        document.getElementById('valoracion').value = '';
        document.getElementById('imagenInput').value = '';
        document.getElementById('nombre').focus();
    }

    async function descargarExcel() {
        if (datosParaExcel.length === 0) {
            alert("No hay datos para descargar.");
            return;
        }

        const workbook = new ExcelJS.Workbook();
        const worksheet = workbook.addWorksheet('Pruebas');

        // Definici√≥n de columnas
        worksheet.columns = [
            { header: 'NOMBRE DE LA PRUEBA', key: 'nombre', width: 25 },
            { header: 'IMAGEN', key: 'imagen', width: 25 },
            { header: 'VALORACI√ìN DE LA PRUEBA', key: 'valoracion', width: 50 },
            { header: 'PRUEBA A COMPA√ëEROS', key: 'resultado', width: 25 }
        ];

        // CAMBIO DE COLORES EN EXCEL (JS)
        const headerRow = worksheet.getRow(1);
        headerRow.height = 40;
        headerRow.eachCell((cell) => {
            cell.fill = {
                type: 'pattern',
                pattern: 'solid',
                fgColor: { argb: 'FF6A1B9A' } // Color Morado Intenso (HEX: 6A1B9A)
            };
            cell.font = { color: { argb: 'FFFFFFFF' }, bold: true, size: 12 };
            cell.alignment = { vertical: 'middle', horizontal: 'center' };
            cell.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
        });

        for (let i = 0; i < datosParaExcel.length; i++) {
            const data = datosParaExcel[i];
            
            const row = worksheet.addRow({
                nombre: data.nombre,
                imagen: '',
                valoracion: data.valoracion,
                resultado: data.resultado
            });

            row.height = 100; 

            // Estilos de filas (Color Lavanda)
            row.eachCell((cell) => {
                cell.alignment = { vertical: 'middle', horizontal: 'center', wrapText: true };
                cell.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FFF3E5F5' } // Color Lavanda Suave (HEX: F3E5F5)
                };
                cell.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
            });

            if (data.imagen) {
                const imageId = workbook.addImage({
                    base64: data.imagen,
                    extension: 'png',
                });

                worksheet.addImage(imageId, {
                    tl: { col: 1.1, row: row.number - 0.9 }, 
                    br: { col: 1.9, row: row.number - 0.1 },
                    editAs: 'oneCell'
                });
            }
        }

        const buffer = await workbook.xlsx.writeBuffer();
        saveAs(new Blob([buffer]), "Pruebas_Fisioterapia_Morado.xlsx");
    }
</script>

</body>
</html>
